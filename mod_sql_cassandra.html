<!DOCTYPE html>
<html>
<head>
<title>ProFTPD module mod_sql_cassandra</title>
</head>

<body bgcolor=white>

<hr><br>
<center>
<h2><b>ProFTPD module <code>mod_sql_cassandra</code></b></h2>
</center>
<hr><br>

<p>
<a href="http://cassandra.apache.org/">Cassandra</a> is a free and open source
"NoSQL" database, offering robust support for clusters of servers, handling
large volumes of data.

<p>
The <code>mod_sql_cassandra</code> module is designed to let ProFTPD's
<code>mod_sql</code> module connect to and use a Cassandra cluster, using
the DataStax <a href="https://github.com/datastax/cpp-driver"><code>cpp-driver</code></a> library.  This module is contained in the
<code>mod_sql_cassandra.c</code> file for ProFTPD 1.3.<i>x</i>.  Installation
instructions are discussed <a href="#Installation">here</a>.

<p>
The most current version of <code>mod_sql_cassandra</code> can be found at:
<pre>
  <a href="https://github.com/Castaglia/proftpd-mod_sql_cassandra.git">https://github.com/Castaglia/proftpd-mod_sql_cassandra.git</a>
</pre>

<h2>Author</h2>
<p>
Please contact TJ Saunders &lt;tj <i>at</i> castaglia.org&gt; with any
questions, concerns, or suggestions regarding this module.

<h2>Directives</h2>
<ul>
  <li><a href="#SQLCassandraConsistency">SQLCassandraConsistency</a>
  <li><a href="#SQLCassandraOptions">SQLCassandraOptions</a>
</ul>

<hr>
<h3><a name="SQLCassandraConsistency">SQLCassandraConsistency</a></h3>
<strong>Syntax:</strong> SQLConsistencyConsistency <em>consistency</em><br>
<strong>Default:</strong> SQLConsistencyConsistency LocalQuorum<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_sql_cassandra<br>
<strong>Compatibility:</strong> 1.3.6rc2 and later

<p>
The <code>SQLCassandraConsistency</code> directive configures the
<em>consistency</em> used when executing statements/queries on the Cassandra
cluster. The default is "LocalQuorum".

<p>
The supported <em>consistency</em> values are:
<ul>
  <li><code>All</code>
  <li><code>Any</code>
  <li><code>EachQuorum</code>
  <li><code>LocalOne</code>
  <li><code>LocalQuorum</code>
  <li><code>One</code>
  <li><code>Quorum</code>
  <li><code>Three</code>
  <li><code>Two</code>
</ul>

<p>
Example:
<pre>
  # Require only one response from any node
  SQLCassandraConsistency One
</pre>

<hr>
<h3><a name="SQLCassandraOptions">SQLCassandraOptions</a></h3>
<strong>Syntax:</strong> SQLConsistencyOptions <em>opt1 ...</em><br>
<strong>Default:</strong> None<br>
<strong>Context:</strong> server config, <code>&lt;VirtualHost&gt;</code>, <code>&lt;Global&gt;</code><br>
<strong>Module:</strong> mod_sql_cassandra<br>
<strong>Compatibility:</strong> 1.3.6rc2 and later

<p>
The <code>SQLCassandraOptions</code> directive is used to configure various
optional behavior of <code>mod_sql_cassandra</code>.

<p>
Example:
<pre>
  SQLCassandraOptions NoClientSideTimestamps
</pre>

<p>
The currently implemented options are:
<ul>
  <li><code>NoClientSideTimestamps</code><br>
    <p>
    By default, Cassandra uses server-assigned <a href="https://datastax.github.io/cpp-driver/topics/basics/client_side_timestamps/"><em>timestamps</em></a>
    for ordering records/changes.  However, the client can assign timestamps
    itself; this behavior usually preserves the principle of least surprise
    better, thus by default <code>mod_sql_cassandra</code> uses client-side
    timestamps.  If, however, you prefer/desire server-side timestamps, use
    this option.
  </li>
</ul>

<p>
<hr>
<h2><a name="Installation">Installation</a></h2>
The <code>mod_sql_cassandra</code> relies on the DataStax <a href="https://github.com/datastax/cpp-driver.git">cpp-driver</a> library.  Follow the usual steps
for using contrib modules in ProFTPD, making sure to list <code>mod_sql</code>.

<p>
For example:
<pre>
  $ ./configure --with-modules=mod_sql:mod_sql_cassandra ...
  $ make
  $ make install
</pre>

<p>
You may need to specify the location of the <code>cpp-driver</code> header and
library files in your <code>configure</code> command, <i>e.g.</i>:
<pre>
  $ ./configure \
    --with-modules=mod_sql:mod_sql_cassandra \
    --with-includes=/usr/local/datastax-cpp/include \
    --with-libraries=/usr/local/datastax-cpp/lib
</pre>

<p>
<hr>
<h2><a name="Usage">Usage</a></h2>

<p>
<b>When should <code>mod_sql_cassandra</code> be used?</b><br>

logging
clustered database

<p>
<b>Configuring <code>mod_sql_cassandra</code></b><br>
For the most part, <code>mod_sql_cassandra</code> requires little configuration.

* mention token-aware, latency-aware routing
* mention default retry policy

The one required bit of information is the
<a href="mod_sql.html#SQLConnectInfo"><code>SQLConnectInfo</code></a> directive.
This directive needs to contain the name of the stanza in your
<code>odbc.ini</code> file which holds the configuration.  Using the example
<code>odbc.ini</code> files above, you would need the following in your
<code>proftpd.conf</code>:
<pre>
  # Tells mod_sql to use mod_sql_cassandra
  SQLBackend cassandra

  # Tells mod_sql_cassandra to connect to localhost, port 19042, and use the
  # 'proftpd' keyspace.
  SQLConnectInfo proftpd@127.0.0.1:19042
</pre>

<p>
<hr>
<font size=2><b><i>
&copy; Copyright 2017 TJ Saunders<br>
 All Rights Reserved<br>
</i></b></font>
<hr>

</body>
</html>
